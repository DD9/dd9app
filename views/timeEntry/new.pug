extends ../index/layout

include ../timeEntry/mixins/_createTimeEntry

block content
  .container.time-entry-container
    .my-5.py-1.px-3.bg-white.rounded.box-shadow
      .row
        .col.mt-2
          h4 New Time Entries
      table#createdTimeEntriesTable.time-entry-table.table.table-sm.w-100
        thead.thead-light
          th.time-entry-th-date Date
          th.time-entry-th-company Company
          th.time-entry-th-hours Hours
          th.time-entry-th-description Description
          th.time-entry-th-actions
        each timeEntry, rowNumber in timeEntries
          tr(id=`createdTimeEntriesTableRow-${rowNumber}`)
            td= h.YYYYMMDD(timeEntry.date)
            td= timeEntry.company.name
            td.time-entry-hours= timeEntry.hours
            td= timeEntry.description
            if user.permissions[0].admin
              td
                form.time-entry-table-action-approve.form.d-inline(action=`/api/v1/timeEntry/${timeEntry._id}/approve` method="POST" data-hours=timeEntry.hours)
                  button.btn.btn-sm.btn-link(type='submit') Approve
                form.time-entry-table-action-hide.form.d-inline(action=`/api/v1/timeEntry/${timeEntry._id}/hide` method="POST" data-hours=timeEntry.hours)
                  button.btn.btn-sm.btn-link(type='submit') Hide
                button.submit-time-entry-btn.btn.btn-sm.btn-link(data-toggle='modal' data-target='#confirmSubmitTimeEntryModal' data-timeentry=timeEntry._id data-hours=timeEntry.hours) Submit
                button.delete-time-entry-btn.btn.btn-sm.btn-link(data-toggle='modal' data-target='#confirmDeleteTimeEntryModal' data-timeentry=timeEntry._id data-hours=timeEntry.hours) Delete
                button.edit-time-entry-btn.btn.btn-sm.btn-link(data-toggle='modal' data-target='#editTimeEntryModal'
                  data-rownumber=rowNumber
                  data-timeentry=timeEntry._id
                  data-date=timeEntry.date
                  data-company=timeEntry.company._id
                  data-hours=timeEntry.hours
                  data-description=timeEntry.description)
                  != h.icon('pencil')
            else
                button.submit-time-entry-btn.btn.btn-sm.btn-link(data-toggle='modal' data-target='#confirmSubmitTimeEntryModal' data-timeentry=timeEntry._id data-hours=timeEntry.hours) Submit
                button.delete-time-entry-btn.btn.btn-sm.btn-link(data-toggle='modal' data-target='#confirmDeleteTimeEntryModal' data-timeentry=timeEntry._id data-hours=timeEntry.hours) Delete
                button.edit-time-entry-btn.btn.btn-sm.btn-link(data-toggle='modal' data-target='#editTimeEntryModal'
                  data-rownumber=rowNumber
                  data-timeentry=timeEntry._id
                  data-date=timeEntry.date
                  data-company=timeEntry.company._id
                  data-hours=timeEntry.hours
                  data-description=timeEntry.description)
                  != h.icon('pencil')

        tr#totalCreatedHoursRow
          td
          td
          td#totalCreatedHours= totalCreatedHours
          td
          td

    .py-1.px-3.bg-white.rounded.box-shadow.time-entry-new-time-entry-card
      .row
        .col.mt-3.mb-2
          h4 Add New Time Entry
      +createTimeEntry()

  #confirmSubmitTimeEntryModal.modal.fade(tabindex='-1', role='dialog', aria-labelledby='confirmSubmitTimeEntryModal', aria-hidden='true')
    .modal-dialog(role='document')
      .modal-content
        .modal-header
          h5.modal-title Confirm Submit
          button.close(type='button', data-dismiss='modal', aria-label='Close')
            span(aria-hidden='true') ×
        .modal-body
          form#confirmSubmitTimeEntryForm.time-entry-table-action-submit.form(action=`/api/v1/timeEntry/:id/submit` method="POST")
            p.text-center Are you sure you want to submit this time entry?
        .modal-footer
          button.btn.btn-secondary(type='button', data-dismiss='modal') Close
          button.confirm-submit-btn.btn.btn-primary(type='submit' form='confirmSubmitTimeEntryForm') Ok

  #confirmDeleteTimeEntryModal.modal.fade(tabindex='-1', role='dialog', aria-labelledby='confirmDeleteTimeEntryModal', aria-hidden='true')
    .modal-dialog(role='document')
      .modal-content
        .modal-header
          h5.modal-title Confirm Delete
          button.close(type='button', data-dismiss='modal', aria-label='Close')
            span(aria-hidden='true') ×
        .modal-body
          form#confirmDeleteTimeEntryForm.time-entry-table-action-delete.form(action=`/api/v1/timeEntry/:id/delete` method="POST")
            p.text-center Are you sure you want to delete this time entry?
        .modal-footer
          button.btn.btn-secondary(type='button', data-dismiss='modal') Close
          button.confirm-delete-btn.btn.btn-primary(form='confirmDeleteTimeEntryForm') Ok

  #editTimeEntryModal.modal.fade(tabindex='-1', role='dialog', aria-labelledby='editTimeEntryModal', aria-hidden='true')
    .modal-dialog(role='document')
      .modal-content
        .modal-header
          h5.modal-title Edit Time Entry
          button.close(type='button', data-dismiss='modal', aria-label='Close')
            span(aria-hidden='true') ×
        .modal-body
          form#editTimeEntryForm.time-entry-form.form(action=`/api/v1/timeEntry/:id/edit` method="POST" novalidate)
            .form-group.row
              label.col-sm-2.col-form-label(for='date') Date
              .col-sm-10
                input#date.form-control(name='date' type='text' value=h.YYYYMMDD(new Date()) required maxlength="10")
            .form-group.row
              label.col-sm-2.col-form-label(for='company') Company
              .col-sm-10
                select#company.form-control(name='company')
                  for company in companies
                    option(value=company._id) #{company.name}
            .form-group.row
              label.col-sm-2.col-form-label(for='hours') Hours
              .col-sm-10
                input#hours.form-control(name='hours' type='tel' required maxlength="5")
                .invalid-feedback Invalid form.
            .form-group.row
              label.col-sm-3.col-form-label(for='description') Description
              .col-sm-9
                input#description.form-control(name='description' type='text' required maxlength="255")
                .invalid-feedback Invalid form.
        .modal-footer
          button.btn.btn-secondary(type='button', data-dismiss='modal') Close
          button.btn.btn-primary(form='editTimeEntryForm') Submit